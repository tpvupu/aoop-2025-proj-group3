<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phaser è³‡æºè¼‰å…¥æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
        }
        h1 {
            color: #333;
        }
        #game-container {
            margin: 20px 0;
            border: 2px solid #ddd;
            background: #eee;
            min-height: 600px;
        }
        .console {
            background: #222;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .log-info { color: #0f0; }
        .log-warn { color: #fa0; }
        .log-error { color: #f00; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Phaser éŠæˆ² - è³‡æºè¼‰å…¥æ¸¬è©¦</h1>
        <div id="game-container"></div>
        <h2>ğŸ“‹ æ§åˆ¶å°è¼¸å‡º</h2>
        <div class="console" id="console"></div>
    </div>

    <!-- Phaser -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <script>
        // è‡ªå®šç¾©æ§åˆ¶å°
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        function log(type, ...args) {
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    return JSON.stringify(arg, null, 2);
                }
                return String(arg);
            }).join(' ');
            
            const line = document.createElement('div');
            line.className = `log-${type}`;
            line.textContent = `[${type.toUpperCase()}] ${message}`;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = (...args) => {
            originalLog(...args);
            log('info', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            log('warn', ...args);
        };
        
        console.error = (...args) => {
            originalError(...args);
            log('error', ...args);
        };

        console.log('é–‹å§‹åŠ è¼‰ Phaser éŠæˆ²...');

        // æ¸¬è©¦å ´æ™¯
        class TestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'TestScene' });
            }
            
            preload() {
                console.log('preload() é–‹å§‹');
                
                // å˜—è©¦è¼‰å…¥æ‰€æœ‰è³‡æº
                const images = [
                    { key: 'bubu_head', path: 'assets/images/Bubu_head.png' },
                    { key: 'yier_head', path: 'assets/images/Yier_head.png' },
                    { key: 'mitao_head', path: 'assets/images/Mitao_head.png' },
                    { key: 'huihui_head', path: 'assets/images/Huihui_head.png' },
                    { key: 'happy', path: 'assets/images/happy.png' },
                    { key: 'sad', path: 'assets/images/sad.png' },
                    { key: 'angry', path: 'assets/images/angry.png' },
                    { key: 'heart', path: 'assets/images/heart.png' },
                    { key: 'background_intro', path: 'assets/images/background_intro.png' }
                ];
                
                images.forEach(img => {
                    console.log(`è¼‰å…¥åœ–ç‰‡: ${img.key} -> ${img.path}`);
                    this.load.image(img.key, img.path);
                });
                
                // è¼‰å…¥éŸ³é »
                const audios = [
                    { key: 'bgm_drumdrum', path: 'assets/sounds/bgm/drumdrum.ogg' },
                    { key: 'bgm_yier_bubu', path: 'assets/sounds/bgm/yier_bubu.ogg' },
                    { key: 'bgm_mitao_huihui', path: 'assets/sounds/bgm/mitao_huihui.ogg' }
                ];
                
                audios.forEach(audio => {
                    console.log(`è¼‰å…¥éŸ³é »: ${audio.key} -> ${audio.path}`);
                    this.load.audio(audio.key, audio.path);
                });
                
                // é€²åº¦äº‹ä»¶
                this.load.on('progress', (progress) => {
                    console.log(`è¼‰å…¥é€²åº¦: ${Math.floor(progress * 100)}%`);
                });
                
                this.load.on('complete', () => {
                    console.log('preload() å®Œæˆï¼');
                });
                
                this.load.on('loaderror', (fileObject) => {
                    console.error(`è¼‰å…¥å¤±æ•—: ${fileObject.key} -> ${fileObject.url}`);
                });
            }
            
            create() {
                console.log('create() é–‹å§‹');
                
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // é¡¯ç¤ºæ¨™é¡Œ
                const title = this.add.text(width / 2, 30, 'âœ“ Phaser éŠæˆ²æˆåŠŸåˆå§‹åŒ–ï¼', {
                    fontSize: '32px',
                    fill: '#00ff00',
                    align: 'center'
                });
                title.setOrigin(0.5);
                
                // é¡¯ç¤ºæ‰€æœ‰å·²è¼‰å…¥çš„ç´‹ç†
                console.log('å·²è¼‰å…¥çš„ç´‹ç†:');
                const textureKeys = this.textures.getTextureKeys();
                textureKeys.forEach(key => {
                    console.log(`  - ${key}`);
                });
                
                // é¡¯ç¤ºè§’è‰²é ­åƒ
                let y = 100;
                const characters = [
                    { key: 'bubu_head', name: 'å¸ƒå¸ƒ' },
                    { key: 'yier_head', name: 'ä¸€äºŒ' },
                    { key: 'mitao_head', name: 'èœœæ¡ƒ' },
                    { key: 'huihui_head', name: 'ç°ç°' }
                ];
                
                characters.forEach(char => {
                    const text = this.add.text(20, y, `${char.name}:`, { fontSize: '18px', fill: '#333' });
                    
                    if (this.textures.exists(char.key)) {
                        const img = this.add.image(150, y, char.key);
                        img.setScale(0.3);
                        console.log(`âœ“ ${char.key} æˆåŠŸè¼‰å…¥`);
                    } else {
                        const errText = this.add.text(150, y, 'âŒ æœªè¼‰å…¥', { fontSize: '16px', fill: '#f00' });
                        console.warn(`âœ— ${char.key} æœªè¼‰å…¥`);
                    }
                    
                    y += 80;
                });
                
                // é¡¯ç¤ºèƒŒæ™¯åœ–
                y += 20;
                const bgText = this.add.text(20, y, 'èƒŒæ™¯:', { fontSize: '18px', fill: '#333' });
                if (this.textures.exists('background_intro')) {
                    const bg = this.add.image(150, y, 'background_intro');
                    bg.setScale(0.2);
                    console.log('âœ“ background_intro æˆåŠŸè¼‰å…¥');
                } else {
                    const errText = this.add.text(150, y, 'âŒ æœªè¼‰å…¥', { fontSize: '16px', fill: '#f00' });
                    console.warn('âœ— background_intro æœªè¼‰å…¥');
                }
            }
        }

        // éŠæˆ²é…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 1200,
            height: 800,
            parent: 'game-container',
            backgroundColor: '#667eea',
            scene: [TestScene]
        };

        // å‰µå»ºéŠæˆ²
        console.log('æ­£åœ¨å‰µå»º Phaser éŠæˆ²...');
        const game = new Phaser.Game(config);
    </script>
</body>
</html>
