# Copilot Instructions for Lazy Me Today Too

- **Architecture**: Pygame desktop game at 1200x800; entry in [main.py](main.py) initializes pygame and hands control to [scene_manager.py](scene_manager.py#L1-L146).
- **Scene flow**: `SceneManager.scene_map` maps string tokens (e.g., `"MAIN"`, `"END"`) to methods; each scene returns the next token. Add scenes by wiring into `scene_map` and returning the next token consistently.
- **Scene pattern**: Most scenes inherit [UI/components/base_scene.py](UI/components/base_scene.py#L1-L71); its `run()` loop calls `update()` then `draw()` each frame at 30 FPS. If a scene overrides `run()` (e.g., [UI/main_scene.py](UI/main_scene.py#L1-L400)), keep event handling + `pygame.event.get()` loop aligned with this cadence.
- **Audio**: Use the singleton `AudioManager.get_instance()` from [UI/components/audio_manager.py](UI/components/audio_manager.py#L1-L84). Avoid instantiating directly; it owns mixer init and caches sound effects. BGM and SFX paths live in [setting.py](setting.py#L1-L86).
- **Assets/paths**: All resource paths are centralized in [setting.py](setting.py#L1-L120). GIF frame folders are auto-indexed into `GIF_PATHS` (directories ending with `_frames`). When adding assets, place them under `resource/*` and prefer `setting` constants to avoid CWD bugs.
- **GIF ingestion**: After adding new GIFs under `resource/gif`, run `python3 resource/gif/gif_to_img.py` (documented in [resource/gif/README.md](resource/gif/README.md#L1-L9)) to explode frames for the animator.
- **Characters & stats**: Core model in [character.py](character.py#L1-L247); actions (`study`, `rest`, `play_game`, `socialize`) mutate attributes and `last_week_change`. Event data is loaded once from [event/events.json](event/events.json) via an absolute path to keep tests stable. Weekly scene flow increments `week_number` before Story/Event in `SceneManager.story_and_event`.
- **UI interactions**: [UI/main_scene.py](UI/main_scene.py#L1-L400) shows the pattern for buttons, hover sound effects, emoji interactions, and diary access. Animation swapping uses `CharacterAnimator.switch_animation()`; keep `active1/2/3` folders on the player to enable click-to-animate.
- **OpenAI features**: [services/feedback_generator.py](services/feedback_generator.py#L1-L140) optionally calls OpenAI (`gpt-4o-mini`). Set `OPENAI_API_KEY` in env or `.env`; file supports a `DEFAULT_OPENAI_API_KEY` stub but do not commit real keys. Fallback heuristics handle missing SDK/keys.
- **AI simulation**: Behavior-tree/FSM policies in [AI/bvtree.py](AI/bvtree.py) drive [AI/simulation.py](AI/simulation.py#L1-L220) runs (7 pre-midterm + 7 post). `Simulation.run_and_plot_all*` writes PNGs/CSVs into `simulation_plots/`. CLI demos/tests live in [AI/test_policy.py](AI/test_policy.py#L1-L120) and related files; run with `python AI/test_policy.py` after installing `matplotlib` deps.
- **Event content**: Narrative text and options come from [event/events.json](event/events.json) and story docs in [event/game_setting](event/game_setting). Keep keys consistent (`week_{n}`) and ensure UTF-8 encoding when editing.
- **Packaging**: macOS app bundling via `./build.sh` uses [build.spec](build.spec); outputs into `dist/`. On Windows run `pyinstaller build.spec` (see instructions in [README.md](README.md#L78-L155)). Add new assets to `datas` in `build.spec` when packaging.
- **Runtime setup**: Local run: `pip install -r requirements.txt` (root), then `python main.py`. Docker run: `source docker_run.sh` builds `oop-2025-proj-group10-image` and starts a container with X11/pulse bindings for audio.
- **Testing/data placement**: Simulation plots and CSVs are generated under `simulation_plots/` and used by ranking scenes; avoid deleting unless regenerating. UI scenes expect fonts under `resource/font/` (see paths in `setting`).
- **Common gotchas**: Ensure `pygame.display.init()` precedes font loading (handled in `main`); avoid relative file paths inside scenesâ€”always pull from `setting`. When returning from scenes, always map outputs to valid `scene_map` keys to prevent getting stuck.
